<html>
	<head>
		<script src="http://www.parsecdn.com/js/parse-1.2.13.min.js"></script>
		<script type="text/javascript">
			Parse.initialize("cmXcRxgoNTg4q1cbNm8R7yCIqBjlCaeBw7UZdIr9", "mcSEzmjS4TPSmqklyq3DGymqWciRfo5HxkhXYSYA");
			window.onload = function() {

				var user;
				var BazaarUser = Parse.Object.extend("BazaarUser");


				var submitButton = document.getElementById('submit');
				var arch = document.getElementsByClassName('arch')[0];
					emailField = document.getElementById('email');


				function showSuccess(message) {
					emailField.remove();
					submitButton.remove();
					
					var successDiv = document.createElement('div');
					successDiv.innerHTML = message;
					arch.appendChild(successDiv);
				}

				if (localStorage) {
					var id = localStorage.getItem('bazaar_id');

					if (id) {
						
						var query = new Parse.Query(BazaarUser);
						query.get(id, {
							success: function(obj) {
								// The object was retrieved successfully.
								user = obj;
								if (user.get('email')) {
									showSuccess('You\'ve already signed up! We can\'t wait to share our story with you.');
								}
								arch.style.opacity = 1.0;
							},
							error: function(object, error) {
								// The object was not retrieved successfully.
								// error is a Parse.Error with an error code and description.
								console.log('These aren\'t the droids you\'re looking for');
								user = new BazaarUser();
								arch.style.opacity = 1.0;
							}
						});
					} else {
						user = new BazaarUser();
						user.save(null, {
							success: function(obj) {
								localStorage.setItem('bazaar_id', user.id);
								arch.style.opacity = 1.0;
							},
							error: function(er) {
								arch.style.opacity = 1.0;
							}
						});
					}
				}

				submitButton.addEventListener('click', function(e) {					
					var email = document.getElementById('email').value;

					// Create a "user"
					user.set("email", email);

					// Save our user
					user.save(null, {
						success: function() {
							showSuccess('Thank you for signing up!');
						},
						error: function() {
							showSuccess('Thank you for signing up!');
						}
					});
				});

			};
		</script>

		<style>
			/* red-color: rgba(190, 81, 76, 0.5) */
			/* tan-color: rgba(255, 242, 208, 1.0000) */
			* {
				-webkit-transition:all 250ms ease-in-out;
				transition:all 250ms ease-in-out;
			}

			body {
				font-size: 16px;
				font-family: Helvetica;
				background-color: #fff2d0;
				font-weight: lighter;
				background: -webkit-linear-gradient(top, rgba(190, 81, 76, 0.5), rgba(255, 242, 208, 0.5)), url('http://barbaraschwarz.files.wordpress.com/2013/05/mlt.jpg');
				background-size: cover;
			}

			.arch {
				width: 400px;
				background-color: rgba(0,0,0,0.4);
				margin:auto;
				margin-top: 80px;
				padding-top: 20px;
				padding-bottom: 20px;
				border-radius: 4px;
				text-align: center;
				color: white;
				opacity: 0;
			}

			input {
				font-size: 1em;
			}

			p.text {
				width:80%;
				margin: auto;
				margin-top: 20px;
				margin-bottom: 20px;
				text-align: left;
				color:white;
				font-size: 0.8em;
				line-height: 1.4em;
			}

			input, div.button {
				display: block;
				width:80%;
				margin:auto;
			}

			div.button {
				padding: 0.8em 0.8em;
				background: #be514c;
				border:1px solid #be514c;
				color: white;
				border-radius: 2px;
				margin-top:0.6em;
			}

			div.button:hover {
				background: #ce615c;
			}

			input[type="email"] {
				box-shadow:none;
				border-radius: 2px;
				border:none;
				padding: 0.8em;
				font-size: 0.8em;
				color: #655;
				margin-top:0.6em;
			}

			input:focus {
				outline: 0;
			}

			/* Mobile Styles */
			@media (max-width: 600) {
				body {
					font-size: 20px;
				}

				.arch {
					width: 90%;
				}
			}


		</style>
	</head>
	<body>
		<div class="arch">
			<h1>Bazaar</h1> <!-- Put branding image here -->
			<p class="text">Now that there is the Tec-9, a crappy spray gun from South Miami. This gun is advertised as the most popular gun in American crime. Do you believe that shit? It actually says that in the little book that comes with it: the most popular gun in American crime. Like they're actually proud of that shit. </p>
			<input id="email" type="email" placeholder="Email address"/>
			<div id="submit" class="button">Let Me Know</div>
		</div>
	</body>
</html>